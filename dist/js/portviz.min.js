function fixSplitsInsideQuotes(e){for(var t=0;t<e.length;t++){var n=e[t].replace(/^[\s]*|[\s]*$/g,""),r="";if(n.charAt(0)==='"'||n.charAt(0)==="'")r=n.charAt(0);r!==""&&n.charAt(n.length-1)===r&&(r="");if(r!==""){var i=t+1;i<e.length&&(n=e[i].replace(/^[\s]*|[\s]*$/g,""));while(i<e.length&&n.charAt(n.length-1)!==r)e[t]+=","+e[i],e.splice(i,1),n=e[i].replace(/[\s]*$/g,"");i<e.length&&(e[t]+=","+e[i],e.splice(i,1))}}}function trimWhitespace(e){for(var t=0;t<e.length;t++)e[t]=e[t].replace(/^[\s]*|[\s]*$/g,"")}function trimQuotes(e){for(var t=0;t<e.length;t++)e[t].charAt(0)==='"'?e[t]=e[t].replace(/^"|"$/g,""):e[t].charAt(0)==="'"&&(e[t]=e[t].replace(/^'|'$/g,""))}function removeEmptyRows(e){var t=[];for(var n=0;n<e.length;n++)e[n].replace(/^[\s]*|[\s]*$/g,"")!==""&&t.push(e[n]);return t}function parseCSVLine(e){var t=e.split(",");return fixSplitsInsideQuotes(t),trimWhitespace(t),trimQuotes(t),t}function parseRows(e){var t=[];for(var n=0;n<e.length;n++)t[n]=parseCSVLine(e[n]);return t}function convertToJson(e){var t=[];for(var n=1;n<e.length;n++){e[n].length>0&&t.push({});for(var r=0;r<e[n].length;r++)t[n-1][e[0][r]]=e[n][r]}return t}function csvToJson(e){if(e==="")throw"empty input";var t=removeEmptyRows(e.split(/[\r\n]/g));if(t.length<2)throw"missing header";var n=parseRows(t),r=convertToJson(n);return r}var MersenneTwister=function(e){e===undefined&&(e=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,this.init_genrand(e)};MersenneTwister.prototype.init_genrand=function(e){this.mt[0]=e>>>0;for(this.mti=1;this.mti<this.N;this.mti++)e=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30,this.mt[this.mti]=(((e&4294901760)>>>16)*1812433253<<16)+(e&65535)*1812433253+this.mti,this.mt[this.mti]>>>=0},MersenneTwister.prototype.init_by_array=function(e,t){var n,r,i;this.init_genrand(19650218),n=1,r=0,i=this.N>t?this.N:t;var s=0;for(;i;i--)s=this.mt[n-1]^this.mt[n-1]>>>30,this.mt[n]=(this.mt[n]^(((s&4294901760)>>>16)*1664525<<16)+(s&65535)*1664525)+e[r]+r,this.mt[n]>>>=0,n++,r++,n>=this.N&&(this.mt[0]=this.mt[this.N-1],n=1),r>=t&&(r=0);for(i=this.N-1;i;i--)s=this.mt[n-1]^this.mt[n-1]>>>30,this.mt[n]=(this.mt[n]^(((s&4294901760)>>>16)*1566083941<<16)+(s&65535)*1566083941)-n,this.mt[n]>>>=0,n++,n>=this.N&&(this.mt[0]=this.mt[this.N-1],n=1);this.mt[0]=2147483648},MersenneTwister.prototype.genrand_int32=function(){var e,t=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var n;this.mti===this.N+1&&this.init_genrand(5489);for(n=0;n<this.N-this.M;n++)e=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK,this.mt[n]=this.mt[n+this.M]^e>>>1^t[e&1];for(;n<this.N-1;n++)e=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK,this.mt[n]=this.mt[n+(this.M-this.N)]^e>>>1^t[e&1];e=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^e>>>1^t[e&1],this.mti=0}return e=this.mt[this.mti++],e^=e>>>11,e^=e<<7&2636928640,e^=e<<15&4022730752,e^=e>>>18,e>>>0},MersenneTwister.prototype.genrand_int31=function(){return this.genrand_int32()>>>1},MersenneTwister.prototype.genrand_real1=function(){return this.genrand_int32()*(1/4294967295)},MersenneTwister.prototype.random=function(){return this.genrand_int32()*(1/4294967296)},MersenneTwister.prototype.genrand_real3=function(){return(this.genrand_int32()+.5)*(1/4294967296)},MersenneTwister.prototype.genrand_res53=function(){var e=this.genrand_int32()>>>5,t=this.genrand_int32()>>>6;return(e*67108864+t)*(1/9007199254740992)},window.App={};var money={};(function(){var e=function(e,t,n){return function(r){var i=r<0?"-":"",s=parseInt(r=Math.abs(+r||0).toFixed(e),10)+"",o=(o=s.length)>3?o%3:0;return i+(o?s.substr(0,o)+n:"")+s.substr(o).replace(/(\d{3})(?=\d)/g,"$1"+n)+(e?t+Math.abs(r-s).toFixed(e).slice(2):"")}};this.fmt=function(){if(arguments.length!==0)throw"wrong arg count";return e(0,".",",")},this.custom=function(t,n,r){if(arguments.length!==3)throw"wrong arg count";if(isNaN(t))throw"invalid cents";if(n===undefined)throw"undefined decimal symbol";if(r===undefined)throw"undefined thousands symbol";return e(t,n,r)}}).apply(money);var boxmuller={};(function(){this.newInstance=function(e){var t=new MersenneTwister(e);return{random:function(){var e=2*t.random()-1,n=2*t.random()-1,r=e*e+n*n;if(r===0||r>1)return this.random();var i=Math.sqrt(-2*Math.log(r)/r);return e*i}}},this.vector=function(e){var t=this.newInstance(),n=[],r=0;for(var i=0;i<e;++i)r+=t.random(),n.push({x:i,y:r});return n}}).apply(boxmuller),App.cols=function(e){var t={};return _.each(e,function(e){_.each(e,function(e,n){t[n]=1})}),_.sortBy(_.keys(t),function(e){return e})},App.projnames=function(){return _.map(App.projSumList.toJSON(),function(e){return e.Project})};var map={};(function(){this.pareto=function(e){var t=e.toJSON(),n=_.map(_.range(5e3),function(e){var n=_.shuffle(t),r=_.random(t.length),i=_.first(n,r),s=0,o=0,u=0;return _.each(i,function(e){s+=+e.Lcost,o+=+e.ENPV,u+=+e.NPV}),{x:s,best:u,expected:o}}),r=_.sortBy(n,function(e){return e.x}),i=[],s=[];return _.each(r,function(e){(_.isEmpty(s)||e.best>_.last(s).y)&&s.push({x:e.x,y:e.best}),(_.isEmpty(i)||e.expected>_.last(i).y)&&i.push({x:e.x,y:e.expected})}),function(e,n,r){return{frontiers:{expected:i,best:s},ports:_.map(_.filter(e,function(e){return n[e.id]}),function(e){var n=0,i=0,s=0,o=0;return _.each(_.filter(t,function(t){var n=e.id+"_"+t.Project;return _.has(r,n)?r[n]:!1}),function(e){n+=+e.Lcost,s+=+e.ENPV,i+=+e.NPV,o-=+e.Lcost}),{x:n,yexpected:s,ybest:i,yworst:o,label:e.name,index:e.index}})}}},this.revenueTimeSeries=function(e){var t=e.toJSON(),n=_.without(App.cols(t),"Projects"),r=_.map(n,function(e){var n=_.reduce(t,function(t,n){return t+Number(n[e])},0);return{x:e,y:n}});return function(){return r}},this.revenueTimeSeriesGrouped=function(e){var t=e.toJSON(),n=_.without(App.cols(t),"Projects"),r=_.map(n,function(e){var n=_.map(t,function(t){return{label:t.Projects,value:+t[e]}}),r={x:e,y:n};return r});return function(){return r}},this.revenueTimeSeriesGroupedWithTarget=function(e,t){var n=e.toJSON(),r=t.toJSON(),i=_.map(_.union(_.without(App.cols(n),"Projects"),_.without(App.cols(r),"Label")),function(e){return+e}).sort(),s={};return s.x=i,s.bars={},s.bars.labels=_.pluck(n,"Projects").sort(),s.bars.data=_.flatten(_.map(n,function(e){return _.map(_.without(_.keys(e),"Projects"),function(t){return{x:t,y:+e[t],label:e.Projects}})})),s.lines={},s.lines.labels=_.pluck(r,"Label").sort(),s.lines.data=_.flatten(_.map(r,function(e){return _.map(_.without(_.keys(e),"Label"),function(t){return{x:t,y:+e[t],label:e.Label}})})),function(){return s}},this.revenueLines=function(e){var t=e.toJSON(),n=_.map(_.without(App.cols(t),"Projects"),function(e){return+e}).sort(),r={};r.x=n;var i=[{portfolio:"Portfolio 1",contains:function(e){return Math.random()>.6}},{portfolio:"Portfolio 2",contains:function(e){return Math.random()>.4}}];return r.labels=_.pluck(i,"portfolio").sort(),r.data=_.flatten(_.map(i,function(e){var n={};return _.each(t,function(t){e.contains(t.Projects)&&_.each(_.without(_.keys(t),"Projects"),function(e){_.has(n,e)||(n[e]=0),n[e]+=+t[e]})}),_.map(_.keys(n),function(t){return{x:t,y:n[t],label:e.portfolio}})})),function(){return r}},this.bubble=function(e){var t=e.toJSON();return function(e,n,r){return _.map(_.filter(e,function(e){return n[e.id]}),function(e){return{label:e.name,index:e.index,data:_.filter(t,function(t){var n=e.id+"_"+t.Project;return _.has(r,n)?r[n]:!1})}})}},this.bingo=function(e){var t=e.toJSON();return function(e,n,r){return _.map(_.filter(e,function(e){return n[e.id]}),function(e){return{portname:e.name,portdata:{x:["Preclinical","Phase 1","Phase 2","Phase 3","NDA","Market"],y:_.uniq(_.pluck(t,"TA")).sort(),data:_.map(_.filter(t,function(t){var n=e.id+"_"+t.Project;return _.has(r,n)?r[n]:!1}),function(e){return{x:e.Stage,y:e.TA,label:e.Project}})}}})}},this.table=function(e){return function(){return e}}}).apply(map);var sampledata={};(function(){this.proj=[{Project:"Avniman",Stage:"Phase 2",TA:"CNS",Grade:"B",Sched_Status:"1: Ahead of Plan",Fin_Status:"1: Under Budget",Fit:"3: Fair",Ptype:"Business Development",Funding:"Potential",NPV:"521.4",Plaunch:"0.25",ENPV:"228.6",Lyear:"2017",PeakSales:"4320",Lcost:"160"},{Project:"Creficil",Stage:"NDA",TA:"Endocrine Disorder",Grade:"A",Sched_Status:"3: Behind Plan",Fin_Status:"1: Under Budget",Fit:"2: Good",Ptype:"Internal Development",Funding:"Funded",NPV:"339.8",Plaunch:"0.23",ENPV:"76.8",Lyear:"2015",PeakSales:"2160",Lcost:"224"},{Project:"Eaglogen",Stage:"Market",TA:"Endocrine Disorder",Grade:"A",Sched_Status:"2: On Plan",Fin_Status:"2: On Budget",Fit:"4: Poor",Ptype:"In-Market",Funding:"Funded",NPV:"4736.3",Plaunch:"0.34",ENPV:"1602.2",Lyear:"2015",PeakSales:"24337.4",Lcost:"155"},{Project:"Estger",Stage:"Phase 1",TA:"Immunology",Grade:"A",Sched_Status:"3: Behind Plan",Fin_Status:"2: On Budget",Fit:"3: Fair",Ptype:"Internal Development",Funding:"Funded",NPV:"902.4",Plaunch:"0.25",ENPV:"226.3",Lyear:"2015",PeakSales:"3930",Lcost:"350"},{Project:"Holitorcitus",Stage:"Phase 2",TA:"Immunology",Grade:"A",Sched_Status:"3: Behind Plan",Fin_Status:"1: Under Budget",Fit:"3: Fair",Ptype:"Internal Development",Funding:"Funded",NPV:"2066.6",Plaunch:"0.36",ENPV:"740.9",Lyear:"2015",PeakSales:"9000",Lcost:"230"},{Project:"Masogen",Stage:"Phase 1",TA:"Immunology",Grade:"A",Sched_Status:"2: On Plan",Fin_Status:"1: Under Budget",Fit:"2: Good",Ptype:"Internal Development",Funding:"Potential",NPV:"376.3",Plaunch:"0.17",ENPV:"64.5",Lyear:"2015",PeakSales:"1260",Lcost:"50"},{Project:"Matisem",Stage:"Phase 1",TA:"Endocrine Disorder",Grade:"A",Sched_Status:"1: Ahead of Plan",Fin_Status:"2: On Budget",Fit:"2: Good",Ptype:"Business Development",Funding:"Potential",NPV:"1080.1",Plaunch:"0.26",ENPV:"283.7",Lyear:"2015",PeakSales:"4704",Lcost:"75"},{Project:"Meprylol",Stage:"Phase 1",TA:"Dermatology",Grade:"A",Sched_Status:"2: On Plan",Fin_Status:"1: Under Budget",Fit:"1: Excellent",Ptype:"Business Development",Funding:"Funded",NPV:"268.8",Plaunch:"0.33",ENPV:"89.5",Lyear:"2015",PeakSales:"900",Lcost:"125"},{Project:"Mervisil",Stage:"Market",TA:"Immunology",Grade:"A",Sched_Status:"1: Ahead of Plan",Fin_Status:"1: Under Budget",Fit:"2: Good",Ptype:"In-Market",Funding:"Funded",NPV:"358.4",Plaunch:"0.97",ENPV:"347.7",Lyear:"2015",PeakSales:"1200",Lcost:"214"},{Project:"Metaphysis",Stage:"Phase 2",TA:"Immunology",Grade:"C",Sched_Status:"1: Ahead of Plan",Fin_Status:"1: Under Budget",Fit:"1: Excellent",Ptype:"Internal Development",Funding:"Funded",NPV:"722.3",Plaunch:"0.7",ENPV:"504.4",Lyear:"2015",PeakSales:"3282",Lcost:"42"},{Project:"Mrilipzor",Stage:"Phase 3",TA:"CNS",Grade:"B",Sched_Status:"4: Critically Behind Plan",Fin_Status:"1: Under Budget",Fit:"2: Good",Ptype:"Internal Development",Funding:"Funded",NPV:"1009.1",Plaunch:"0.22",ENPV:"218.5",Lyear:"2015",PeakSales:"3900",Lcost:"422"},{Project:"Mritigen",Stage:"Phase 1",TA:"CNS",Grade:"A",Sched_Status:"3: Behind Plan",Fin_Status:"2: On Budget",Fit:"2: Good",Ptype:"Internal Development",Funding:"Funded",NPV:"688.9",Plaunch:"0.3",ENPV:"207.9",Lyear:"2015",PeakSales:"3000",Lcost:"322"},{Project:"Nifilmox",Stage:"Phase 2",TA:"Ophthalmology",Grade:"B",Sched_Status:"3: Behind Plan",Fin_Status:"2: On Budget",Fit:"3: Fair",Ptype:"Internal Development",Funding:"Potential",NPV:"1033.3",Plaunch:"0.25",ENPV:"257.2",Lyear:"2015",PeakSales:"4500",Lcost:"541"},{Project:"OpthTank",Stage:"Phase 1",TA:"Ophthalmology",Grade:"A",Sched_Status:"2: On Plan",Fin_Status:"1: Under Budget",Fit:"2: Good",Ptype:"Business Development",Funding:"Potential",NPV:"268.8",Plaunch:"0.19",ENPV:"52.3",Lyear:"2015",PeakSales:"900",Lcost:"322"},{Project:"Polgen",Stage:"Phase 3",TA:"Immunology",Grade:"B",Sched_Status:"3: Behind Plan",Fin_Status:"2: On Budget",Fit:"2: Good",Ptype:"Internal Development",Funding:"Potential",NPV:"632.4",Plaunch:"0.25",ENPV:"158.4",Lyear:"2015",PeakSales:"2754",Lcost:"333"},{Project:"Prototase",Stage:"Phase 2",TA:"Endocrine Disorder",Grade:"A",Sched_Status:"3: Behind Plan",Fin_Status:"4: Critically Over Budget",Fit:"2: Good",Ptype:"Business Development",Funding:"Funded",NPV:"910",Plaunch:"0.22",ENPV:"196.1",Lyear:"2015",PeakSales:"3900",Lcost:"444"},{Project:"Refevel",Stage:"Phase 2",TA:"CNS",Grade:"A",Sched_Status:"3: Behind Plan",Fin_Status:"1: Under Budget",Fit:"2: Good",Ptype:"Business Development",Funding:"Funded",NPV:"267.7",Plaunch:"0.25",ENPV:"65",Lyear:"2017",PeakSales:"1200",Lcost:"34.5"},{Project:"Reflitol",Stage:"NDA",TA:"CNS",Grade:"A",Sched_Status:"1: Ahead of Plan",Fin_Status:"2: On Budget",Fit:"1: Excellent",Ptype:"Internal Development",Funding:"Funded",NPV:"1047.1",Plaunch:"0.2",ENPV:"212.9",Lyear:"2015",PeakSales:"4800",Lcost:"42"},{Project:"Resdexel",Stage:"Preclinical",TA:"Endocrine Disorder",Grade:"A",Sched_Status:"4: Critically Behind Plan",Fin_Status:"1: Under Budget",Fit:"4: Poor",Ptype:"Internal Development",Funding:"Funded",NPV:"528.3",Plaunch:"0.19",ENPV:"97.7",Lyear:"2020",PeakSales:"4500",Lcost:"123"},{Project:"Rilopof",Stage:"Phase 1",TA:"CNS",Grade:"A",Sched_Status:"1: Ahead of Plan",Fin_Status:"1: Under Budget",Fit:"2: Good",Ptype:"Internal Development",Funding:"Potential",NPV:"868.8",Plaunch:"0.22",ENPV:"191.7",Lyear:"2012",PeakSales:"2700",Lcost:"32"},{Project:"Rydovanil",Stage:"Phase 1",TA:"CNS",Grade:"A",Sched_Status:"3: Behind Plan",Fin_Status:"1: Under Budget",Fit:"3: Fair",Ptype:"Internal Development",Funding:"Potential",NPV:"310.4",Plaunch:"0.27",ENPV:"66.3",Lyear:"2021",PeakSales:"2400",Lcost:"167.5"},{Project:"Rytifil",Stage:"NDA",TA:"Ophthalmology",Grade:"B",Sched_Status:"3: Behind Plan",Fin_Status:"1: Under Budget",Fit:"3: Fair",Ptype:"Internal Development",Funding:"Funded",NPV:"361.4",Plaunch:"0.94",ENPV:"339.7",Lyear:"2012",PeakSales:"840",Lcost:"32"},{Project:"Tikofermin",Stage:"Phase 3",TA:"Dermatology",Grade:"A",Sched_Status:"2: On Plan",Fin_Status:"1: Under Budget",Fit:"2: Good",Ptype:"Business Development",Funding:"Funded",NPV:"1262.6",Plaunch:"0.63",ENPV:"794.1",Lyear:"2012",PeakSales:"2160",Lcost:"111"},{Project:"Trivlexin",Stage:"Phase 3",TA:"Endocrine Disorder",Grade:"A",Sched_Status:"3: Behind Plan",Fin_Status:"1: Under Budget",Fit:"3: Fair",Ptype:"Business Development",Funding:"Funded",NPV:"1024.5",Plaunch:"0.6",ENPV:"581.3",Lyear:"2015",PeakSales:"4800",Lcost:"127.1"},{Project:"Varmenase",Stage:"Phase 2",TA:"Endocrine Disorder",Grade:"A",Sched_Status:"2: On Plan",Fin_Status:"1: Under Budget",Fit:"4: Poor",Ptype:"Business Development",Funding:"Funded",NPV:"1694.6",Plaunch:"0.32",ENPV:"544.1",Lyear:"2015",PeakSales:"7380",Lcost:"66"},{Project:"Virtiman",Stage:"Preclinical",TA:"Immunology",Grade:"A",Sched_Status:"4: Critically Behind Plan",Fin_Status:"1: Under Budget",Fit:"1: Excellent",Ptype:"Internal Development",Funding:"Funded",NPV:"350.5",Plaunch:"0.26",ENPV:"76.4",Lyear:"2023",PeakSales:"3600",Lcost:"107.5"},{Project:"Vrexigen",Stage:"Phase 1",TA:"CNS",Grade:"B",Sched_Status:"2: On Plan",Fin_Status:"2: On Budget",Fit:"4: Poor",Ptype:"Internal Development",Funding:"Funded",NPV:"-8.8",Plaunch:"0.16",ENPV:"-46.3",Lyear:"2020",PeakSales:"900",Lcost:"299.2"},{Project:"Vrilimen",Stage:"Phase 1",TA:"Ophthalmology",Grade:"B",Sched_Status:"3: Behind Plan",Fin_Status:"1: Under Budget",Fit:"2: Good",Ptype:"Internal Development",Funding:"Funded",NPV:"353.1",Plaunch:"0.32",ENPV:"93.6",Lyear:"2019",PeakSales:"3000",Lcost:"185.9"},{Project:"Weglifil",Stage:"Phase 1",TA:"Immunology",Grade:"B",Sched_Status:"2: On Plan",Fin_Status:"1: Under Budget",Fit:"2: Good",Ptype:"Internal Development",Funding:"Funded",NPV:"593.2",Plaunch:"0.18",ENPV:"97.4",Lyear:"2020",PeakSales:"4800",Lcost:"77.1"},{Project:"Xumanase",Stage:"Preclinical",TA:"CNS",Grade:"A",Sched_Status:"3: Behind Plan",Fin_Status:"1: Under Budget",Fit:"2: Good",Ptype:"Internal Development",Funding:"Funded",NPV:"1239.9",Plaunch:"0.09",ENPV:"113",Lyear:"2015",PeakSales:"5400",Lcost:"99"},{Project:"Xyfigil",Stage:"Phase 1",TA:"Endocrine Disorder",Grade:"B",Sched_Status:"2: On Plan",Fin_Status:"1: Under Budget",Fit:"1: Excellent",Ptype:"Internal Development",Funding:"Funded",NPV:"3.4",Plaunch:"0.29",ENPV:"-35.2",Lyear:"2022",PeakSales:"1188",Lcost:"302.2"},{Project:"Zerxil",Stage:"Phase 3",TA:"Endocrine Disorder",Grade:"A",Sched_Status:"2: On Plan",Fin_Status:"1: Under Budget",Fit:"1: Excellent",Ptype:"Internal Development",Funding:"Funded",NPV:"172.2",Plaunch:"0.93",ENPV:"158.5",Lyear:"2014",PeakSales:"600",Lcost:"46.1"}],this.rev=[{2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"300",2019:"1200",2020:"3000",2021:"4200",2022:"4320",Projects:"Avniman"},{2013:"0",2014:"0",2015:"544",2016:"2160",2017:"1784",2018:"550",2019:"156",2020:"30",2021:"6",2022:"1",Projects:"Creficil"},{2013:"0",2014:"0",2015:"0",2016:"2341",2017:"5388",2018:"9753",2019:"16482",2020:"18150",2021:"20001",2022:"22055",Projects:"Eaglogen"},{2013:"0",2014:"0",2015:"655",2016:"1965",2017:"3275",2018:"3930",2019:"3930",2020:"2358",2021:"98",2022:"0",Projects:"Estger"},{2013:"0",2014:"0",2015:"1500",2016:"4500",2017:"7500",2018:"9000",2019:"9000",2020:"5400",2021:"225",2022:"0",Projects:"Holitorcitus"},{2013:"0",2014:"0",2015:"210",2016:"630",2017:"1050",2018:"1260",2019:"1260",2020:"1134",2021:"882",2022:"630",Projects:"Masogen"},{2013:"0",2014:"0",2015:"784",2016:"2352",2017:"3920",2018:"4704",2019:"4704",2020:"2822",2021:"118",2022:"0",Projects:"Matisem"},{2013:"0",2014:"0",2015:"150",2016:"450",2017:"750",2018:"900",2019:"900",2020:"810",2021:"630",2022:"450",Projects:"Meprylol"},{2013:"0",2014:"0",2015:"200",2016:"600",2017:"1000",2018:"1200",2019:"1200",2020:"1080",2021:"840",2022:"600",Projects:"Mervisil"},{2013:"0",2014:"0",2015:"547",2016:"1641",2017:"2735",2018:"3282",2019:"3282",2020:"1969",2021:"82",2022:"0",Projects:"Metaphysis"},{2013:"0",2014:"0",2015:"975",2016:"2925",2017:"3900",2018:"3900",2019:"3900",2020:"2340",2021:"97",2022:"0",Projects:"Mrilipzor"},{2013:"0",2014:"0",2015:"500",2016:"1500",2017:"2500",2018:"3000",2019:"3000",2020:"1800",2021:"75",2022:"0",Projects:"Mritigen"},{2013:"0",2014:"0",2015:"750",2016:"2250",2017:"3750",2018:"4500",2019:"4500",2020:"2700",2021:"112",2022:"0",Projects:"Nifilmox"},{2013:"0",2014:"0",2015:"150",2016:"450",2017:"750",2018:"900",2019:"900",2020:"810",2021:"630",2022:"450",Projects:"OpthTank"},{2013:"0",2014:"0",2015:"459",2016:"1377",2017:"2295",2018:"2754",2019:"2754",2020:"1652",2021:"69",2022:"0",Projects:"Polgen"},{2013:"0",2014:"0",2015:"650",2016:"1950",2017:"3250",2018:"3900",2019:"3900",2020:"2535",2021:"251",2022:"0",Projects:"Prototase"},{2013:"0",2014:"0",2015:"0",2016:"0",2017:"200",2018:"600",2019:"1000",2020:"1200",2021:"1200",2022:"1080",Projects:"Refevel"},{2013:"0",2014:"0",2015:"800",2016:"2400",2017:"4000",2018:"4800",2019:"4800",2020:"2880",2021:"120",2022:"0",Projects:"Reflitol"},{2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"750",2021:"2250",2022:"3750",Projects:"Resdexel"},{2013:"1350",2014:"2250",2015:"2700",2016:"2700",2017:"1620",2018:"68",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Rilopof"},{2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"600",2022:"1800",Projects:"Rydovanil"},{2013:"420",2014:"700",2015:"840",2016:"840",2017:"840",2018:"714",2019:"462",2020:"210",2021:"14",2022:"0",Projects:"Rytifil"},{2013:"1080",2014:"1800",2015:"2160",2016:"2160",2017:"2160",2018:"2160",2019:"2160",2020:"2030",2021:"1771",2022:"1512",Projects:"Tikofermin"},{2013:"0",2014:"0",2015:"800",2016:"2400",2017:"4000",2018:"4800",2019:"4800",2020:"2880",2021:"120",2022:"0",Projects:"Trivlexin"},{2013:"0",2014:"0",2015:"1230",2016:"3690",2017:"6150",2018:"7380",2019:"7380",2020:"4428",2021:"184",2022:"0",Projects:"Varmenase"},{2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Virtiman"},{2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"150",2021:"450",2022:"750",Projects:"Vrexigen"},{2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"500",2020:"1500",2021:"2500",2022:"3000",Projects:"Vrilimen"},{2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"800",2021:"2400",2022:"4000",Projects:"Weglifil"},{2013:"0",2014:"0",2015:"900",2016:"2700",2017:"4500",2018:"5400",2019:"5400",2020:"3240",2021:"135",2022:"0",Projects:"Xumanase"},{2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"198",Projects:"Xyfigil"},{2013:"0",2014:"100",2015:"300",2016:"500",2017:"600",2018:"600",2019:"540",2020:"420",2021:"300",2022:"180",Projects:"Zerxil"}],this.revtarget=[{Label:"Target",2013:"60000",2014:"62000",2015:"64000",2016:"66000",2017:"68000",2018:"70000",2019:"72000",2020:"74000",2021:"76000",2022:"78000"},{Label:"Another Target",2013:"40000",2014:"45000",2015:"50000",2016:"55000",2017:"60000",2018:"65000",2019:"70000",2020:"75000",2021:"80000",2022:"85000"},{Label:"Really Optimistic Target",2013:"20000",2014:"24000",2015:"29000",2016:"35000",2017:"42000",2018:"50000",2019:"60000",2020:"72000",2021:"86000",2022:"103000"}],this.budget=[{Label:"Budget",2013:"600",2014:"620",2015:"540",2016:"760",2017:"680",2018:"700",2019:"520",2020:"540",2021:"600",2022:"800"}],this.costs=[{2012:"40",2013:"20",2014:"20",2015:"40",2016:"20",2017:"20",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Avniman"},{2012:"0",2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Creficil"},{2012:"24",2013:"41",2014:"85",2015:"5",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Eaglogen"},{2012:"0",2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Estger"},{2012:"0",2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Holitorcitus"},{2012:"0",2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Masogen"},{2012:"0",2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Matisem"},{2012:"0",2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Meprylol"},{2012:"0",2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Mervisil"},{2012:"0",2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Metaphysis"},{2012:"0",2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Mrilipzor"},{2012:"0",2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Mritigen"},{2012:"0",2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Nifilmox"},{2012:"0",2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"OpthTank"},{2012:"0",2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Polgen"},{2012:"0",2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Prototase"},{2012:"7",2013:"7",2014:"7",2015:"7",2016:"3.95",2017:"2.5",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Refevel"},{2012:"0",2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Reflitol"},{2012:"17.43",2013:"17.43",2014:"17.43",2015:"17.43",2016:"17.43",2017:"17.43",2018:"13.89",2019:"3.27",2020:"1.31",2021:"1.31",2022:"1.31",Projects:"Resdexel"},{2012:"3.36",2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Rilopof"},{2012:"0",2013:"0",2014:"15.33",2015:"16.76",2016:"18.18",2017:"22.73",2018:"33.33",2019:"33.33",2020:"25.26",2021:"25.26",2022:"25.26",Projects:"Rydovanil"},{2012:"1",2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Rytifil"},{2012:"30",2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Tikofermin"},{2012:"71.43",2013:"41.27",2014:"11.11",2015:"3.33",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Trivlexin"},{2012:"0",2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Varmenase"},{2012:"8.89",2013:"8.71",2014:"8",2015:"8",2016:"8.88",2017:"12.4",2018:"12.4",2019:"12.4",2020:"12.4",2021:"12.4",2022:"12.4",Projects:"Virtiman"},{2012:"23.33",2013:"27.67",2014:"32",2015:"32",2016:"60",2017:"60",2018:"60",2019:"2.64",2020:"1.56",2021:"1.56",2022:"1.56",Projects:"Vrexigen"},{2012:"17.8",2013:"19.6",2014:"19.6",2015:"35.71",2016:"35.71",2017:"35.71",2018:"19.81",2019:"1.95",2020:"0",2021:"0",2022:"0",Projects:"Vrilimen"},{2012:"4.2",2013:"4.2",2014:"4.2",2015:"15",2016:"15",2017:"15",2018:"15",2019:"2.97",2020:"1.48",2021:"1.48",2022:"1.48",Projects:"Weglifil"},{2012:"0",2013:"0",2014:"0",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Xumanase"},{2012:"28",2013:"25",2014:"25",2015:"25",2016:"39",2017:"39",2018:"39",2019:"39",2020:"39",2021:"39",2022:"39",Projects:"Xyfigil"},{2012:"27.33",2013:"16.22",2014:"2.55",2015:"0",2016:"0",2017:"0",2018:"0",2019:"0",2020:"0",2021:"0",2022:"0",Projects:"Zerxil"}]}).apply(sampledata),App.ProjectSummaryModel=Backbone.Model.extend({}),App.ProjectSummaries=Backbone.Collection.extend({model:App.ProjectSummaryModel}),App.projSumList=new App.ProjectSummaries,App.projSumList.reset(sampledata.proj),App.ProjectRevenueModel=Backbone.Model.extend({}),App.ProjectRevenues=Backbone.Collection.extend({model:App.ProjectRevenueModel}),App.projRevList=new App.ProjectRevenues,App.projRevList.reset(sampledata.rev),App.RevenueTargetModel=Backbone.Model.extend({}),App.RevenueTargets=Backbone.Collection.extend({model:App.RevenueTargetModel}),App.revTargetList=new App.RevenueTargets,App.revTargetList.reset(sampledata.revtarget),App.BudgetModel=Backbone.Model.extend({}),App.Budgets=Backbone.Collection.extend({model:App.BudgetModel}),App.budgetList=new App.Budgets,App.budgetList.reset(sampledata.budget),App.CostModel=Backbone.Model.extend({}),App.Costs=Backbone.Collection.extend({model:App.CostModel}),App.costList=new App.Costs,App.costList.reset(sampledata.costs),App.CsvModel=Backbone.Model.extend({defaults:{csvtext:"project name, attr name 1, attr name 2\nFoo, val A, val B\nBar, val C, val D",csvrevtext:"project name, 2012, 2013\nFoo, 100, 200\nBar, 150, 220"}}),App.PortfolioListModel=Backbone.Model.extend({defaults:function(){var e={};return _.each(ui.portconf,function(t){e[t.id]=!0}),e}}),App.MembershipModel=Backbone.Model.extend({defaults:function(){var e=boxmuller.newInstance(1),t={};return _.each(ui.portconf,function(e){var n=_.shuffle(App.projnames()),r=_.random(App.projnames().length),i=_.first(n,r);_.each(App.projnames(),function(n){t[e.id+"_"+n]=_.contains(i,n)})}),t}}),App.portfolios=[],App.visiblePortfolios=[],App.revenueTarget=5e4,App.budget=5e4;var charts={};(function(){}).apply(charts),function(){this.xaxis=function(){var e=720,t=445,n="",r,i=12,s=function(i){var s=e-App.margins.left-App.margins.right,o=t-App.margins.top-App.margins.bottom;i.each(function(e,t){var i=d3.select(this),u=d3.svg.axis().scale(r).orient("bottom"),a=i.selectAll(".x.axis").data(["hi"]);a.enter().append("g").attr("class","x axis").attr("transform","translate(0,"+o+")"),a.call(u);var f=a.selectAll(".x.label").data([n]);f.enter().append("text"),f.attr("class","x label").attr("text-anchor","middle").attr("x",s/2).attr("y",App.margins.bottom).attr("dy","-0.75em").text(function(e){return e})})};return s.width=function(t){return arguments.length?(e=t,s):e},s.height=function(e){return arguments.length?(t=e,s):t},s.label=function(e){return arguments.length?(n=e,s):n},s.scale=function(e){return arguments.length?(r=e,s):r},s},this.yaxis=function(){var e=720,t=445,n="",r,i=function(i){var s=e-App.margins.left-App.margins.right,o=t-App.margins.top-App.margins.bottom;i.each(function(e,t){var i=d3.select(this),s=d3.svg.axis().scale(r).orient("left"),u=i.selectAll(".y.axis").data(["hi"]);u.enter().append("g").attr("class","y axis"),u.call(s);var a=u.selectAll(".y.label").data([n]);a.enter().append("text"),a.attr("class","y label").attr("text-anchor","middle").attr("dy","1em").attr("transform","translate("+ -1*App.margins.left+", "+o/2+") rotate(-90)").text(function(e){return e})})};return i.width=function(t){return arguments.length?(e=t,i):e},i.height=function(e){return arguments.length?(t=e,i):t},i.label=function(e){return arguments.length?(n=e,i):n},i.scale=function(e){return arguments.length?(r=e,i):r},i}}.apply(charts),function(){this.barchart=function(){var e=720,t=445,n="",r="",i=function(i){var s=e-App.margins.left-App.margins.right,o=t-App.margins.top-App.margins.bottom;i.each(function(i,u){var a=i,f=a.map(function(e){return e.y}),l=d3.min(f);l>0&&(l=0);var c=d3.max(f),h=d3.scale.ordinal().domain(a.map(function(e){return e.x})).rangeRoundBands([0,s],.1),p=d3.scale.linear().domain([l,c]).rangeRound([o,0]);d3.select(this).selectAll("*:not(svg)").remove();var d=d3.select(this).selectAll("svg").data(["hi"]);d.enter().append("svg");var v=d.attr("width",e).attr("height",t).append("g").attr("transform","translate("+App.margins.left+","+App.margins.top+")"),m=charts.xaxis().width(e).height(t).label(n).scale(h),g=charts.yaxis().width(e).height(t).label(r).scale(p);v.call(m),v.call(g);var y=v.selectAll(".bar").data(a);y.enter().append("rect"),y.exit().remove(),y.attr("class","bar").attr("x",function(e){return h(e.x)}).attr("width",h.rangeBand()).attr("y",function(e){return p(e.y)}).attr("height",function(e){return o-p(e.y)})})};return i.width=function(t){return arguments.length?(e=t,i):e},i.height=function(e){return arguments.length?(t=e,i):t},i.xlabel=function(e){return arguments.length?(n=e,i):n},i.ylabel=function(e){return arguments.length?(r=e,i):r},i}}.apply(charts),function(){this.bingo=function(){var e=720,t=445,n="",r="",i=function(i){var s=e-App.margins.left-App.margins.right,o=t-App.margins.top-App.margins.bottom;i.each(function(i,u){var a=[],f=[],l=[],c=0;_.each(i,function(e,t){var n={};a=_.union(a,e.portdata.x),f=_.union(f,e.portdata.y),_.each(e.portdata.data,function(r){var i=r.x+"::"+r.y;_.isUndefined(n[i])&&(n[i]=0);var s=n[i],o=_.extend(r,{i:s,j:t,portname:e.portname,key:e.portname+"::"+r.label});n[i]++,l.push(o),c=_.max([c,n[i]])})});var h=.1,p=d3.scale.ordinal().domain(a).rangeRoundBands([0,s],h),d=d3.scale.ordinal().domain(f).rangeRoundBands([0,o],h),v=d3.scale.category10().domain(_.range(100)),m=charts.xaxis().width(e).height(t).label(n).scale(p),g=charts.yaxis().width(e).height(t).label(r).scale(d);d3.select(this).selectAll("table").remove(),d3.select(this).selectAll("div.tab-content").remove(),d3.select(this).selectAll("svg.stacked-bar-line").remove(),d3.select(this).selectAll("svg.linechart").remove(),d3.select(this).selectAll("svg.scatter").remove();var y=d3.select(this).selectAll("svg").data(["hi"]);y.enter().append("svg"),y.exit().remove(),y.attr("width",e).attr("height",t).attr("class","bingochart");var b=y.selectAll("g.chartcontainer").data(["hi"]);b.enter().append("g"),b.exit().remove(),b.attr("class","chartcontainer").attr("transform","translate("+App.margins.left+","+App.margins.top+")");var w=b.selectAll("a.dot").data(l,function(e){return e.key});w.enter().append("a").each(function(){console.log("enter")}),w.exit().remove(),w.attr("class","dot bingo").attr("rel","tooltip").attr("data-original-title",function(e){return e.label+"("+e.portname+")"});var E=w.selectAll("circle").data(function(e){return[e]});E.enter().append("circle").attr("cx",function(e){return p(e.x)+p.rangeBand()*(e.i*2+1)/(c*2)}).attr("cy",function(e){return d(e.y)+d.rangeBand()*(e.j*2+1)/(i.length*2)}),E.exit().remove();var S=s/(c*a.length),x=o/(i.length*f.length),T=.8*_.min([S,x])/2;E.transition().attr("cx",function(e){return p(e.x)+p.rangeBand()*(e.i*2+1)/(c*2)}).attr("cy",function(e){return d(e.y)+d.rangeBand()*(e.j*2+1)/(i.length*2)}).attr("r",T).attr("fill",function(e){return v(e.j)}).attr("name",function(e){return e.label}).attr("opacity",1),b.call(m),b.call(g);var N=b.selectAll(".xgrid").data(a);N.enter().append("line"),N.exit().remove(),N.attr("class","xgrid").attr("x1",function(e){return p(e)+p.rangeBand()*(1+h/2)}).attr("x2",function(e){return p(e)+p.rangeBand()*(1+h/2)}).attr("y1",d.rangeExtent()[0]).attr("y2",d.rangeExtent()[1]);var C=b.selectAll(".ygrid").data(f);C.enter().append("line"),C.exit().remove(),C.attr("class","ygrid").attr("y1",function(e){return d(e)-d.rangeBand()*(h/2)}).attr("y2",function(e){return d(e)-d.rangeBand()*(h/2)}).attr("x1",p.rangeExtent()[0]).attr("x2",p.rangeExtent()[1])}),$("[rel=tooltip]").tooltip({html:!0})};return i.width=function(t){return arguments.length?(e=t,i):e},i.height=function(e){return arguments.length?(t=e,i):t},i.xlabel=function(e){return arguments.length?(n=e,i):n},i.ylabel=function(e){return arguments.length?(r=e,i):r},i}}.apply(charts),function(){this.bubblechart=function(){var e=720,t=445,n="",r="",i=!1,s=function(s){var o=e-App.margins.left-App.margins.right,u=t-App.margins.top-App.margins.bottom;s.each(function(s,a){d3.select(this).selectAll("table").remove(),d3.select(this).selectAll("div.tab-content").remove(),d3.select(this).selectAll("svg.stacked-bar-line").remove(),d3.select(this).selectAll("svg.linechart").remove(),d3.select(this).selectAll("svg.scatter").remove(),d3.select(this).selectAll("line.xgrid").remove(),d3.select(this).selectAll("line.ygrid").remove(),_.each(s,function(e,t){var n=_.reduce(e.data,function(e,t){return e+Number(t.Lcost)},0),r=_.reduce(e.data,function(e,t){return e+Number(t.NPV)},0),i=_.reduce(e.data,function(e,t){return e+Number(t.ENPV)},0),s=i/r;e.data=_.map(e.data,function(t){return _.extend(_.clone(t),{label:e.label,labelindex:e.index,seriescost:n,seriesrisk:s,seriesenpv:i})})}),_.each(s,function(e){_.sortBy(e.data,function(e){return-1*i?e.seriesnpv:e.ENPV})});var f=_.min(_.flatten(_.map(s,function(e){return _.map(e.data,function(e){return i?e.seriescost:+e.Lcost})}))),l=_.max(_.flatten(_.map(s,function(e){return _.map(e.data,function(e){return i?e.seriescost:+e.Lcost})}))),c=d3.scale.linear().domain([0,l]).range([0,o]).nice(),h=d3.scale.linear().domain([0,1]).range([u,0]).nice(),p=_.min(_.flatten(_.map(s,function(e){return _.map(e.data,function(e){return i?e.seriesenpv:+e.ENPV})}))),d=_.max(_.flatten(_.map(s,function(e){return _.map(e.data,function(e){return i?e.seriesenpv:+e.ENPV})}))),v=d3.scale.pow().exponent(.85).domain([0,d]).range([0,e/30]),m=d3.scale.category10().domain(_.range(100)),g=charts.xaxis().width(e).height(t).label(n).scale(c),y=charts.yaxis().width(e).height(t).label(r).scale(h),b=d3.select(this).selectAll("svg").data(["hi"]);b.enter().append("svg"),b.exit().remove(),b.attr("width",e).attr("height",t).attr("class","bubble dot chart");var w=b.selectAll("g.chartcontainer").data(["hi"]);w.enter().append("g"),w.exit().remove(),w.attr("class","chartcontainer").attr("transform","translate("+App.margins.left+","+App.margins.top+")"),w.call(g),w.call(y);var E=_.flatten(_.map(s,function(e){return _.map(e.data,function(t){var n=e.label+"::"+t.Project;return _.extend(_.clone(t),{key:n,project:t.Project,label:e.label})})})),S=function(e){return i?v(e.seriesenpv):Math.max(40,+e.ENPV<0?5:v(+e.ENPV))},x=w.selectAll("a.dot").data(E,function(e){return e.key});x.enter().append("a"),x.attr("class","dot").attr("rel","tooltip").attr("data-original-title",function(e){return[i?e.label:e.Project,"<br>EPNV: ",Number(i?e.seriesenpv:e.ENPV).toFixed(),"<br>cost: ",Number(i?e.seriescost:e.Lcost).toFixed(),"<br>p: ",Number(i?e.seriesrisk:e.Plaunch).toFixed(2)].join("")});var T=x.selectAll("circle").data(function(e){return[e]}),N=T.enter().append("circle").attr("cx",function(e){return c(i?e.seriescost:+e.Lcost)}).attr("cy",function(e){return h(i?e.seriesrisk:+e.Plaunch)}).attr("r",S);i&&N.attr("opacity",0),T.exit().remove();var C=T.transition();C.attr("cx",function(e){return c(i?e.seriescost:+e.Lcost)}).attr("cy",function(e){return h(i?e.seriesrisk:+e.Plaunch)}).attr("r",function(e){return(i?+e.seriesenpv:+e.ENPV)<0?5:v(i?+e.seriesenpv:+e.ENPV)}).attr("fill",function(e,t){return(i?e.seriesenpv:e.ENPV)<0?"white":m(e.labelindex)}).attr("stroke",function(e,t){return m(e.labelindex)}).attr("name",function(e){return e.Project}),i?C.transition().duration(0).attr("opacity",1):C.attr("opacity",s.length>1?1/Math.sqrt(s.length):1);var k=x.exit();i?k.remove():(k.select("circle").transition().attr("r",S).remove(),k.transition().remove())}),$("[rel=tooltip]").tooltip({html:!0})};return s.width=function(t){return arguments.length?(e=t,s):e},s.height=function(e){return arguments.length?(t=e,s):t},s.summary=function(e){return arguments.length?(i=e,s):i},s.xlabel=function(e){return arguments.length?(n=e,s):n},s.ylabel=function(e){return arguments.length?(r=e,s):r},s}}.apply(charts),function(){this.line=function(){var e=720,t=445,n="",r="",i=function(i){var s=e-App.margins.left-App.margins.right,o=t-App.margins.top-App.margins.bottom;i.each(function(i,u){var a=d3.max(_.pluck(i.data,"y")),f=d3.scale.ordinal().domain(i.x).rangeRoundBands([0,s],.1),l=d3.scale.linear().domain([0,a]).range([o,0]).nice(),c=charts.xaxis().width(e).height(t).label(n).scale(f),h=charts.yaxis().width(e).height(t).label(r).scale(l),p=d3.svg.line().x(function(e){return f(e.x)+f.rangeBand()/2}).y(function(e){return l(e.y)});d3.select(this).selectAll("table").remove(),d3.select(this).selectAll("div.tab-content").remove(),d3.select(this).selectAll("svg.stacked-bar-line").remove(),d3.select(this).selectAll("svg.bubble").remove(),d3.select(this).selectAll("svg.bingochart").remove();var d=d3.select(this).selectAll("svg").data(["hi"]);d.enter().append("svg"),d.exit().remove(),d.attr("width",e).attr("height",t).attr("class","linechart");var v=d.selectAll("g").data(["hi"]);v.enter().append("g"),v.exit().remove(),v.attr("transform","translate("+App.margins.left+","+App.margins.top+")"),v.call(c),v.call(h);var m=_.map(i.labels,function(e){return _.compact(_.map(i.x,function(t){var n=_.find(i.data,function(n){return n.label===e&&n.x===t});return n}))}),g=v.selectAll("path.line").data(m);g.enter().append("path"),g.exit().remove(),g.attr("class","line").transition().attr("d",p)})};return i.width=function(t){return arguments.length?(e=t,i):e},i.height=function(e){return arguments.length?(t=e,i):t},i.xlabel=function(e){return arguments.length?(n=e,i):n},i.ylabel=function(e){return arguments.length?(r=e,i):r},i}}.apply(charts),function(){this.multi=function(){var e=[],t=720,n=445,r=function(r){var i=_.max(_.map(e,function(e){return _.reduce(e,function(e,t){return e+(t.colspan?t.colspan:1)},0)})),s=n/e.length;r.each(function(r,o){d3.select(this).selectAll("div.tab-content > svg").remove(),d3.select(this).selectAll("table.data-table").remove();var u=d3.select(this).selectAll("div").data(["hi"]);u.enter().append("div");var a=u.selectAll("table").data(["hi"]);a.enter().append("table").attr("class","multi");var f=a.selectAll("tr").data(e);f.enter().append("tr"),f.exit().remove(),f.each(function(e,o){var u=t/i,a=d3.select(this).selectAll("td").data(e);a.enter().append("td"),a.exit().remove(),a.attr("colspan",function(e){return e.colspan?e.colspan:1}).attr("rowspan",function(e){return e.rowspan?e.rowspan:1}).each(function(e,i){var o=u*(e.colspan?e.colspan:1),a=s*(e.rowspan?e.rowspan:1),f=o/t,l=a/n,c=d3.select(this).selectAll("svg.cellcontainer").data([["g"]]);c.enter().append("svg").attr("class","cellcontainer"),c.exit().remove(),c.attr("width",o).attr("height",a);var h=e.datum(r.ports,r.portview,r.membership),p=c.selectAll("g.gcontainer").data([h]);p.enter().append("g").attr("class","gcontainer"),p.exit().remove(),p.attr("transform","scale("+f+","+l+")"),p.call(e.mychart.width(t).height(n))})})})};return r.components=function(t){return arguments.length?(e=t,r):e},r.width=function(e){return arguments.length?(t=e,r):t},r.height=function(e){return arguments.length?(n=e,r):n},r}}.apply(charts),function(){this.pareto=function(){var e=720,t=445,n="",r="",i=function(i){var s=e-App.margins.left-App.margins.right,o=t-App.margins.top-App.margins.bottom;i.each(function(i,u){var a=i.ports,f=_.union(_.pluck(i.frontiers.best,"x"),_.pluck(i.frontiers.expected,"x"),_.pluck(a,"x")),l=d3.min(f),c=d3.max(f),h=_.union(_.pluck(i.frontiers.best,"y"),_.pluck(i.frontiers.expected,"y"),_.flatten(_.map(a,function(e){return[e.yexpected,e.ybest,e.yworst]}))),p=d3.min(h),d=d3.max(h),v=d3.scale.linear().domain([l,c]).range([0,s]).nice(),m=d3.scale.linear().domain([p,d]).range([o,0]).nice(),g=d3.scale.category10().domain(_.range(100)),y=charts.xaxis().width(e).height(t).label(n).scale(v),b=charts.yaxis().width(e).height(t).label(r).scale(m),w=d3.svg.line().x(function(e){return v(e.x)}).y(function(e){return m(e.yexpected)});d3.select(this).selectAll("table").remove(),d3.select(this).selectAll("svg.stacked-bar").remove(),d3.select(this).selectAll("svg.stacked-bar-line").remove(),d3.select(this).selectAll("svg.linechart").remove(),d3.select(this).selectAll("svg.bingochart").remove(),d3.select(this).selectAll("svg.bubble").remove();var E=d3.select(this).selectAll("svg.scatter").data(["hi"]);E.enter().append("svg"),E.exit().remove(),E.attr("class","scatter").attr("width",e).attr("height",t);var S=E.selectAll("g").data(["hi"]);S.enter().append("g"),S.exit().remove(),S.attr("transform","translate("+App.margins.left+","+App.margins.top+")"),S.call(y),S.call(b);var x=S.selectAll("a.dot").data(a,function(e){return e.label});x.enter().append("a"),x.attr("class","dot").attr("rel","tooltip").attr("data-original-title",function(e){return[e.label,"<br>EPNV: ",Number(e.yexpected).toFixed(),"<br>cost: ",Number(e.x).toFixed()].join("")});var T=x.selectAll("circle").data(function(e){return[e]});T.enter().append("circle").attr("cx",w.x()).attr("cy",w.y()),T.transition().attr("cx",w.x()).attr("cy",w.y()).attr("r",8).attr("stroke",function(e){return g(e.index)}).attr("fill",function(e){return g(e.index)}),T.exit().remove();var N=x.selectAll("rect").data(function(e){return[e]});N.enter().append("rect").attr("x",function(e){return v(e.x)-2}).attr("y",function(e){return m(e.yexpected)}).attr("width",4),N.transition().attr("x",function(e){return v(e.x)-2}).attr("width",4).attr("y",function(e){return m(e.ybest)}).attr("height",function(e){return m(e.yworst)-m(e.ybest)}).attr("fill",function(e){return g(e.index)}),x.exit().selectAll("rect").transition().attr("y",function(e){return m(e.yexpected)}).attr("height",0).remove(),x.exit().selectAll("circle").transition().attr("r",0).remove(),x.exit().transition().remove();var C=d3.svg.line().x(function(e){return v(e.x)}).y(function(e){return m(e.y)}),k=S.selectAll("path.bestline").data([i.frontiers.best]);k.enter().append("path"),k.exit().remove(),k.attr("class","bestline").transition().attr("d",C).attr("stroke","black").attr("fill","none");var L=S.selectAll("path.eline").data([i.frontiers.expected]);L.enter().append("path"),L.exit().remove(),L.attr("class","eline").transition().attr("d",C).attr("stroke","black").attr("fill","none")}),$("[rel=tooltip]").tooltip({html:!0})};return i.width=function(t){return arguments.length?(e=t,i):e},i.height=function(e){return arguments.length?(t=e,i):t},i.xlabel=function(e){return arguments.length?(n=e,i):n},i.ylabel=function(e){return arguments.length?(r=e,i):r},i}}.apply(charts),function(){this.scatter=function(){var e=720,t=445,n="",r="",i=function(i){var s=e-App.margins.left-App.margins.right,o=t-App.margins.top-App.margins.bottom;i.each(function(i,u){var a=i.map(function(e){return e.x}),f=d3.min(a),l=d3.max(a),c=i.map(function(e){return e.y}),h=d3.min(c),p=d3.max(c),d=d3.scale.linear().domain([f,l]).range([0,s]).nice(),v=d3.scale.linear().domain([h,p]).range([o,0]).nice(),m=d3.scale.category10().domain(_.range(100)),g=charts.xaxis().width(e).height(t).label(n).scale(d),y=charts.yaxis().width(e).height(t).label(r).scale(v),b=d3.svg.line().x(function(e){return d(e.x)}).y(function(e){return v(e.y)});d3.select(this).selectAll("table").remove(),d3.select(this).selectAll("svg.stacked-bar").remove(),d3.select(this).selectAll("svg.stacked-bar-line").remove(),d3.select(this).selectAll("svg.linechart").remove(),d3.select(this).selectAll("svg.bingochart").remove(),d3.select(this).selectAll("svg.bubble").remove();var w=d3.select(this).selectAll("svg.scatter").data(["hi"]);w.enter().append("svg"),w.exit().remove(),w.attr("class","scatter").attr("width",e).attr("height",t);var E=w.selectAll("g").data(["hi"]);E.enter().append("g"),E.exit().remove(),E.attr("transform","translate("+App.margins.left+","+App.margins.top+")"),E.call(g),E.call(y);var S=E.selectAll("a.dot").data(i,function(e){return e.label});S.enter().append("a"),S.exit().remove(),S.attr("class","dot").attr("rel","tooltip").attr("data-original-title",function(e){return[e.label,"<br>EPNV: ",Number(e.y).toFixed(),"<br>cost: ",Number(e.x).toFixed()].join("")});var x=S.selectAll("circle").data(function(e){return[e]});x.enter().append("circle").attr("cx",b.x()).attr("cy",b.y()),x.transition().attr("cx",b.x()).attr("cy",b.y()).attr("r",8).attr("fill",function(e){return m(e.index)}),x.exit().remove()}),$("[rel=tooltip]").tooltip({html:!0})};return i.width=function(t){return arguments.length?(e=t,i):e},i.height=function(e){return arguments.length?(t=e,i):t},i.xlabel=function(e){return arguments.length?(n=e,i):n},i.ylabel=function(e){return arguments.length?(r=e,i):r},i}}.apply(charts),function(){this.stackedbar=function(){var e=720,t=445,n="",r="",i=function(i){var s=e-App.margins.left-App.margins.right,o=t-App.margins.top-App.margins.bottom;i.each(function(i,u){var a=i,f=_.uniq(_.flatten(_.map(a,function(e){return _.map(e.y,function(e){return e.label})}))).sort();a.forEach(function(e){var t=0;e.y=_.map(f,function(n){var r=_.find(e.y,function(e){return e.label===n}),i=r?r.value:0,s=t+i;return t=s,{label:n,value:i,cumulative:s}})});var l=d3.max(_.pluck(_.flatten(_.pluck(a,"y")),"cumulative")),c=d3.scale.ordinal().domain(a.map(function(e){return e.x})).rangeRoundBands([0,s],.1),h=d3.scale.linear().domain([0,l]).range([o,0]).nice();d3.select(this).selectAll("*:not(svg)").remove();var p=d3.select(this).selectAll("svg").data(["hi"]);p.enter().append("svg");var d=p.attr("width",e).attr("height",t).append("g").attr("transform","translate("+App.margins.left+","+App.margins.top+")"),v=charts.xaxis().width(e).height(t).label(n).scale(c),m=charts.yaxis().width(e).height(t).label(r).scale(h);d.call(v),d.call(m);var g=d.selectAll(".group").data(a).enter().append("g").attr("class","group").attr("transform",function(e){return"translate("+c(e.x)+",0)"}),y=g.selectAll(".stackedbar").data(function(e){return e.y});y.enter().append("rect"),y.exit().remove(),y.attr("class",function(e,t){return f.length>=5?"stackedbar catcolor"+t%2:"stackedbar bincolor"+t}).attr("width",c.rangeBand()).attr("y",function(e){return h(e.cumulative)}).attr("height",function(e){return h(0)-h(e.value)})})};return i.width=function(t){return arguments.length?(e=t,i):e},i.height=function(e){return arguments.length?(t=e,i):t},i.xlabel=function(e){return arguments.length?(n=e,i):n},i.ylabel=function(e){return arguments.length?(r=e,i):r},i}}.apply(charts),function(){this.stackedbarline=function(){var e=720,t=445,n="",r="",i=function(i){var s=e-App.margins.left-App.margins.right,o=t-App.margins.top-App.margins.bottom;i.each(function(i,u){_.each(i.x,function(e){var t=0,n=0;_.each(i.bars.labels,function(r){var s=_.find(i.bars.data,function(t){return t.label===r&&t.x===e});_.isUndefined(s)||(s.cumulative=t+s.y,t=s.cumulative,s.color=i.bars.labels.length>=5?"catcolor"+n%2:"bincolor"+n%5,n++)})});var a=d3.max(_.union(_.pluck(i.bars.data,"cumulative"),_.pluck(i.lines.data,"y"))),f=d3.scale.ordinal().domain(i.x).rangeRoundBands([0,s],.1),l=d3.scale.linear().domain([0,a]).range([o,0]).nice();d3.select(this).selectAll("svg").remove(),d3.select(this).selectAll("table").remove();var c=d3.select(this).selectAll("svg").data(["hi"]);c.enter().append("svg").attr("class","stacked-bar-line");var h=c.attr("width",e).attr("height",t).append("g").attr("transform","translate("+App.margins.left+","+App.margins.top+")"),p=charts.xaxis().width(e).height(t).label(n).scale(f),d=charts.yaxis().width(e).height(t).label(r).scale(l);h.call(p),h.call(d),h.selectAll(".stackedbar").data(i.bars.data).enter().append("rect").attr("class",function(e){return"stackedbar "+e.color}).attr("x",function(e){return f(e.x)}).attr("width",f.rangeBand()).attr("y",function(e){return l(e.cumulative)}).attr("height",function(e){return l(0)-l(e.y)});var v=d3.svg.line().x(function(e){return f(e.x)+f.rangeBand()/2}).y(function(e){return l(e.y)}),m=_.map(i.lines.labels,function(e){return _.compact(_.map(i.x,function(t){var n=_.find(i.lines.data,function(n){return n.label===e&&n.x===t});return n}))});h.selectAll(".line").data(m).enter().append("path").attr("class","line").attr("d",v)})};return i.width=function(t){return arguments.length?(e=t,i):e},i.height=function(e){return arguments.length?(t=e,i):t},i.xlabel=function(e){return arguments.length?(n=e,i):n},i.ylabel=function(e){return arguments.length?(r=e,i):r},i}}.apply(charts),function(){this.table=function(){var e=function(e){e.each(function(e,t){var n=App.cols(e),r=[];_.each(e,function(e){var t=[];_.each(n,function(n,r){t[r]=e[n]}),r.push(t)}),d3.select(this).selectAll("*:not(table)").remove();var i=d3.select(this).selectAll("table").data(["table"]),s=i.enter().append("table").attr("class","table data-table table-bordered table-condensed table-hover"),o=i.selectAll("thead").data(["thead"]);o.enter().append("thead");var u=o.selectAll("tr").data(["tr"]);u.enter().append("tr");var a=u.selectAll("th").data(n);a.enter().append("th"),a.text(function(e){return e});var f=i.append("tbody").selectAll("tr").data(r);f.enter().append("tr");var l=f.selectAll("td").data(function(e){return e});l.enter().append("td"),l.text(function(e){return e})})};return e.height=function(){return e},e.width=function(){return e},e}}.apply(charts);var upload={};(function(){this.uploader=function(){var e=function(e){var t=e.append("div").attr("class","modal hide fade").attr("id","uploader"),n=t.append("div").attr("class","modal-header");n.append("h3").text("Upload project data");var r=t.append("div").attr("class","modal-body");r.append("p").text("Paste your CSV below"),r.append("textarea").attr("name","csvtext").attr("rows","5").attr("class","input-block-level");var i=t.append("div").attr("class","modal-footer");i.append("a").attr("data-dismiss","modal").attr("class","btn").text("Close"),i.append("a").attr("data-dismiss","modal").attr("id","uploadit").attr("class","btn btn-primary").text("Save")};return e},this.revuploader=function(){var e=function(e){var t=e.append("div").attr("class","modal hide fade").attr("id","revuploader"),n=t.append("div").attr("class","modal-header");n.append("h3").text("Upload project revenue data");var r=t.append("div").attr("class","modal-body");r.append("p").text("Paste your CSV below"),r.append("textarea").attr("name","csvrevtext").attr("rows","5").attr("class","input-block-level");var i=t.append("div").attr("class","modal-footer");i.append("a").attr("data-dismiss","modal").attr("class","btn").text("Close"),i.append("a").attr("data-dismiss","modal").attr("id","revuploadit").attr("class","btn btn-primary").text("Save")};return e}}).apply(upload);var viz={};(function(){var e=[{name:"bubbles",datum:map.bubble(App.projSumList),mychart:charts.bubblechart().xlabel("Launch Cost(M)").ylabel("Risk (launch probability)")},{name:"portfolio bubbles",datum:map.bubble(App.projSumList),mychart:charts.bubblechart().summary(!0).xlabel("Launch Cost (M)").ylabel("Risk (eNPV/NPV)")},{name:"portfolio landscape",datum:map.bingo(App.projSumList),mychart:charts.bingo().xlabel("Phase").ylabel("Therapeutic Area")},{name:"pareto",datum:map.pareto(App.projSumList),mychart:charts.pareto().xlabel("Launch Cost (M)").ylabel("eNPV (M)")},{name:"revenue",datum:map.revenueTimeSeriesGroupedWithTarget(App.projRevList,App.revTargetList),mychart:charts.stackedbarline().xlabel("Calendar Year").ylabel("Revenue (M)")},{name:"cost",datum:map.revenueTimeSeriesGroupedWithTarget(App.costList,App.budgetList),mychart:charts.stackedbarline().xlabel("Calendar Year").ylabel("Cost (M)")},{name:"portfolio revenue",datum:map.revenueLines(App.projRevList),mychart:charts.line().xlabel("Calendar Year").ylabel("Revenue (M)")},{name:"portfolio cost",datum:map.revenueLines(App.costList),mychart:charts.line().xlabel("Calendar Year").ylabel("Cost (M)")},{name:"table",datum:map.table(App.projSumList.toJSON()),mychart:charts.table()},{name:"multi",datum:function(e,t,n){return{ports:e,portview:t,membership:n}},mychart:charts.multi().components([[{datum:map.bubble(App.projSumList),mychart:charts.bubblechart().xlabel("Launch Cost(M)").ylabel("Risk (launch probability)")},{datum:map.bubble(App.projSumList),mychart:charts.bubblechart().summary(!0).xlabel("Launch Cost (M)").ylabel("Risk (eNPV/NPV)")}],[{datum:map.bingo(App.projSumList),mychart:charts.bingo().xlabel("Phase").ylabel("Therapeutic Area")},{datum:map.revenueTimeSeriesGroupedWithTarget(App.projRevList,App.revTargetList),mychart:charts.stackedbarline().xlabel("Calendar Year").ylabel("Revenue (M)")}]])},{name:"another multi",datum:function(e,t,n){return{ports:e,portview:t,membership:n}},mychart:charts.multi().components([[{datum:map.bubble(App.projSumList),mychart:charts.bubblechart().xlabel("Launch Cost(M)").ylabel("Risk (launch probability)")},{datum:map.bingo(App.projSumList),mychart:charts.bingo().xlabel("Phase").ylabel("Therapeutic Area")},{datum:map.revenueTimeSeriesGroupedWithTarget(App.costList,App.budgetList),mychart:charts.stackedbarline().xlabel("Calendar Year").ylabel("Cost (M)")}],[{datum:map.revenueLines(App.costList),mychart:charts.line().xlabel("Calendar Year").ylabel("Revenue (M)")},{datum:map.revenueTimeSeriesGroupedWithTarget(App.projRevList,App.revTargetList),mychart:charts.stackedbarline().xlabel("Calendar Year").ylabel("Revenue (M)")},{datum:map.revenueTimeSeries(App.projRevList),mychart:charts.barchart().xlabel("Calendar Year").ylabel("Revenue (M)")}],[{datum:map.revenueLines(App.projRevList),mychart:charts.line().xlabel("Calendar Year").ylabel("Revenue (M)")},{datum:map.revenueTimeSeriesGrouped(App.projRevList),mychart:charts.stackedbar().xlabel("Calendar Year").ylabel("Revenue (M)")},{datum:map.revenueTimeSeries(App.projRevList),mychart:charts.barchart().xlabel("Calendar Year").ylabel("Revenue (M)")}]])},{name:"yet another multi",datum:function(e,t,n){return{ports:e,portview:t,membership:n}},mychart:charts.multi().components([[{datum:map.bubble(App.projSumList),mychart:charts.bubblechart().xlabel("Launch Cost(M)").ylabel("Risk (launch probability)"),colspan:2,rowspan:2},{datum:map.bingo(App.projSumList),mychart:charts.bingo().xlabel("Phase").ylabel("Therapeutic Area"),colspan:1}],[{datum:map.revenueTimeSeriesGroupedWithTarget(App.projRevList,App.revTargetList),mychart:charts.stackedbarline().xlabel("Calendar Year").ylabel("Revenue (M)")}],[{datum:map.revenueTimeSeriesGroupedWithTarget(App.costList,App.budgetList),mychart:charts.stackedbarline().xlabel("Calendar Year").ylabel("Cost (M)")},{datum:map.revenueTimeSeries(App.projRevList),mychart:charts.barchart().xlabel("Calendar Year").ylabel("Revenue (M)")},{datum:map.revenueTimeSeries(App.projRevList),mychart:charts.barchart().xlabel("Calendar Year").ylabel("Revenue (M)")}]])}],t=function(){var e=720,t=445,n=0,r,i,s,o=function(o){o.each(function(o,u){var a=o[n],f=a.datum(i,s,r),l=d3.select(this).selectAll("div").data([f]);l.enter().append("div").attr("class","tab-content"),l.call(a.mychart.width(e).height(t))})};return o.portview=function(e){return arguments.length?(s=e,o):s},o.ports=function(e){return arguments.length?(i=e,o):i},o.membership=function(e){return arguments.length?(r=e,o):r},o.tabindex=function(e){return arguments.length?(n=e,o):n},o.width=function(t){return arguments.length?(e=t,o):e},o.height=function(e){return arguments.length?(t=e,o):t},o},n=function(){var e=function(e){e.each(function(e,t){var n=d3.select(this).selectAll("ul").data([e.conf]);n.enter().append("ul").attr("class","nav nav-tabs");var r=n.selectAll("li").data(function(e){return e});r.enter().append("li").append("a").attr("id",function(e,t){return"l"+t}).attr("href","javascript:void(0)").attr("class","viztab").text(function(e){return e.name}),r.attr("class",function(t,n){return n===e.tab?"active":""})})};return e};this.viztitle=function(){var e=function(e){var t=e.selectAll(".title").data(["Visualizations"]);t.enter().append("h4").attr("class","title").text(_.identity),t.exit().remove()};return e},this.viztabs=function(){var t=0,r=function(r){var i=r.selectAll(".viztabcontainer").data([{tab:t,conf:e}]);i.enter().append("div").attr("class","viztabcontainer"),i.call(n())};return r.tabindex=function(e){return arguments.length?(t=e,r):t},r},this.vizcontent=function(){var n=720,r=445,i=0,s,o,u,a=function(a){var f=a.selectAll(".vizcontentcontainer").data([e]);f.enter().append("div").attr("class","vizcontentcontainer"),f.call(t().width(n).height(r).tabindex(i).membership(s).ports(o).portview(u))};return a.portview=function(e){return arguments.length?(u=e,a):u},a.ports=function(e){return arguments.length?(o=e,a):o},a.membership=function(e){return arguments.length?(s=e,a):s},a.tabindex=function(e){return arguments.length?(i=e,a):i},a.width=function(e){return arguments.length?(n=e,a):n},a.height=function(e){return arguments.length?(r=e,a):r},a}}).apply(viz);var ui={};(function(){this.portvizrender=function(){var e=function(e){var t=e.append("div").attr("class","row-fluid"),n=t.append("div").attr("class","span3");n.append("div").attr("id","portvizmenu");var r=t.append("div").attr("class","span9");r.append("div").attr("id","portvizviz")};return e},this.mainrender=function(){var e=function(e){var t=e.append("div").attr("id","wrap"),n=t.append("div").attr("class","container-fluid"),r=n.append("div"),i=r.append("div").attr("class","row-fluid").append("div").attr("class","span12").append("div").attr("class","navbar").append("div").attr("class","navbar-inner");i.append("a").attr("class","brand").attr("href","#").html("Enrich Portfolio Visualizer");var s=i.append("form").attr("class","navbar-form pull-right");s.append("a").attr("href","#uploader").attr("class","btn").attr("role","button").attr("data-toggle","modal").html("Upload project data"),s.append("a").attr("href","#revuploader").attr("class","btn").attr("role","button").attr("data-toggle","modal").html("Upload project revenue data"),r.call(ui.portvizrender()),e.append("div").attr("id","uploaders").call(upload.uploader()).call(upload.revuploader())};return e},this.portvizmenuhead=function(){var e=function(e){e.each(function(e,t){var n=d3.select(this),r=n.append("div").attr("class","accordion-heading").append("label").attr("class","checkbox");r.append("input").attr("type","checkbox").attr("id","bind_"+e.id).attr("value",""),r.append("a").attr("class","accordion-toggle").attr("data-toggle","collapse").attr("data-parent","#"+e.parent_id).attr("href","#"+e.id).text(e.name)})};return e},this.portvizmanual=function(){var e=function(e){e.each(function(e,t){var n=d3.select(this),r=n.append("div").attr("class","accordion-group").data([{parent_id:e.parent_id,id:e.id,name:e.name}]).call(ui.portvizmenuhead()),i=r.append("div").attr("class","accordion-body collapse").attr("id",e.id).append("div").attr("class","accordion-inner");i.append("p").text("Manual portfolio config, e.g. a list of checkboxes");var s=i.append("form").append("fieldset");s.append("legend").text("Configuration");var o=s.selectAll("label").data(App.projSumList.toJSON()).enter().append("label").attr("class","checkbox");o.text(function(e){return e.Project}),o.append("input").attr("type","checkbox").attr("id",function(t){return"bind_"+e.id+"_"+t.Project}).attr("name",function(e){return e.Project}).attr("value","")})};return e},this.portvizrnr=function(){var e=function(e){e.each(function(e,t){var n=d3.select(this),r="portvizrnr",i=n.append("div").attr("class","accordion-group").data([{parent_id:e.parent_id,id:r,name:"Choose projects in NPV order"}]).call(ui.portvizmenuhead()),s=i.append("div").attr("class","accordion-body collapse").attr("id",r).append("div").attr("class","accordion-inner");s.append("p").text('This is the "rank and yank" portfolio, an algorithm that ranks projectsby NPV, and fills the portfolio until you run out of budget.');var o=s.append("form").append("fieldset");o.append("legend").text("Configuration"),o.append("label").text("budget limit"),o.append("input").attr("type","text").attr("id","foo")})};return e},this.portviznpv=function(){var e=function(e){e.each(function(e,t){var n=d3.select(this),r="portviznpv",i=n.append("div").attr("class","accordion-group").data([{parent_id:e.parent_id,id:r,name:"Risk-neutral maximum NPV"}]).call(ui.portvizmenuhead()),s=i.append("div").attr("class","accordion-body collapse").attr("id",r).append("div").attr("class","accordion-inner");s.append("p").text("This is what Ron Howard rationalists say you should do:Optimize over project combinations to find the highestportfoio expected risk-neutral NPV, given only a cost constraint");var o=s.append("form").append("fieldset");o.append("legend").text("Configuration"),o.append("label").text("budget limit"),o.append("input").attr("type","text").attr("id","foo")})};return e},this.portvizprospect=function(){var e=function(e){e.each(function(e,t){var n=d3.select(this),r="portvizprospect",i=n.append("div").attr("class","accordion-group").data([{parent_id:e.parent_id,id:r,name:"Prospect-theorist utility function"}]).call(ui.portvizmenuhead()),s=i.append("div").attr("class","accordion-body collapse").attr("id",r).append("div").attr("class","accordion-inner");s.append("p").text("This is what behavioral economists think you should do:Optimize over project combinations to find the highestportfoio expected NPV, given a cost constraintand some utility function parameters");var o=s.append("form").append("fieldset");o.append("legend").text("Configuration"),o.append("label").text("budget limit"),o.append("input").attr("type","text").attr("id","foo"),o.append("label").text("maximum loss limit"),o.append("input").attr("type","text").attr("id","foo"),o.append("label").text("loss aversion"),o.append("input").attr("type","text").attr("id","foo"),o.append("label").text("risk aversion"),o.append("input").attr("type","text").attr("id","foo")})};return e},this.portvizmenu=function(){var e=function(e){var t=e,n="portvizmenu";t.append("h4").text("Portfolios");var r=t.append("div").attr("class","accordion").attr("id",n),i=_.map(ui.portconf,function(e){return _.extend(e,{parent_id:n,id:e.id,render:ui.porttypes[e.type].render})}),s=r.selectAll("div").data(i);s.enter().append("div"),s.each(function(e,t){d3.select(this).call(e.render)}),t.append("div").classed("row-fluid",1).append("div").classed("span12",1).append("a").attr("href","#").attr("class","btn pull-right").text("Make a new portfolio")};return e},this.portvizviz=function(){var e=function(e){e.each(function(e,t){d3.select(this).call(viz.viztitle()).call(viz.viztabs().tabindex(e.tabindex)).call(viz.vizcontent().width(e.width).height(e.height).tabindex(e.tabindex).membership(e.membership).ports(e.ports).portview(e.portview))})};return e},this.porttypes={portvizprospect:{render:ui.portvizprospect()},portviznpv:{render:ui.portviznpv()},portvizrnr:{render:ui.portvizrnr()},portvizmanual:{render:ui.portvizmanual()}},this.portconf=[{index:0,id:"p1",type:"portvizmanual",name:"Option One"},{index:1,id:"p2",type:"portvizmanual",name:"Option Two"},{index:2,id:"p3",type:"portvizmanual",name:"Option Three"},{index:3,id:"p4",type:"portvizmanual",name:"Option Four"},{index:4,id:"p5",type:"portvizmanual",name:"Option Five"},{index:5,id:"p6",type:"portvizmanual",name:"Option Six"}]}).apply(ui),App.goldenRatio=1.618,App.widthPad=20,App.PortVizMenu=function(e){e.empty(),d3.selectAll(e).call(ui.portvizmenu())},App.MainRenderer=function(e){d3.selectAll(e).call(ui.mainrender())},App.PortVizViz=function(e,t,n,r){var i=e.width(),s=i-App.widthPad,o=i/App.goldenRatio;d3.selectAll(e).data([{width:s,height:o,tabindex:t,membership:n.toJSON(),ports:ui.portconf,portview:r.toJSON()}]).call(ui.portvizviz())},App.MainView=Backbone.View.extend({currenttab:0,membershipmodel:undefined,portfoliolistmodel:undefined,csvmodel:undefined,membershipModelBinder:undefined,portfolioListModelBinder:undefined,uploadModelBinder:undefined,initialize:function(){this.membershipModelBinder=new Backbone.ModelBinder,this.portfolioListModelBinder=new Backbone.ModelBinder,this.uploadModelBinder=new Backbone.ModelBinder,this.membershipmodel=new App.MembershipModel,this.portfoliolistmodel=new App.PortfolioListModel,this.membershipmodel.bind("change",this.fixup,this),this.portfoliolistmodel.bind("change",this.fixup,this)},render:function(){this.csvmodel=new App.CsvModel,this.$el.empty(),App.MainRenderer(this.$el),App.PortVizMenu($("#portvizmenu")),this.renderviz();var e={};_.each(_.keys(this.membershipmodel.toJSON()),function(t){e[t]="#bind_"+t});var t={};_.each(_.keys(this.portfoliolistmodel.toJSON()),function(e){t[e]="#bind_"+e}),this.membershipModelBinder.bind(this.membershipmodel,this.el,e),this.portfolioListModelBinder.bind(this.portfoliolistmodel,this.el,t),this.uploadModelBinder.bind(this.csvmodel,this.$("#uploaders")),$("[rel=tooltip]").tooltip({html:!0})},renderviz:function(){App.PortVizViz($("#portvizviz"),this.currenttab,this.membershipmodel,this.portfoliolistmodel)},events:{"click #uploadit":"uploadit","click #revuploadit":"revuploadit","click .viztab":"viztab"},fixup:function(){this.renderviz()},viztab:function(e){this.currenttab=e.target.id.substring(1),this.renderviz()},uploadit:function(e){console.log("raw data: "+JSON.stringify(this.csvmodel.toJSON()));var t=this.csvmodel.get("csvtext"),n=csvToJson(t);console.log("parsed data: "+JSON.stringify(n)),App.projSumList.reset(n),App.PortVizMenu($("#portvizmenu")),App.PortVizViz($("#portvizviz"),this.currenttab,this.membershipmodel,this.portfoliolistmodel)},revuploadit:function(e){console.log("raw revenue data: "+JSON.stringify(this.csvmodel.toJSON()));var t=this.csvmodel.get("csvrevtext"),n=csvToJson(t);console.log("parsed revenue data: "+JSON.stringify(n)),App.projRevList.reset(n),App.PortVizMenu($("#portvizmenu")),App.PortVizViz($("#portvizviz"),this.currenttab,this.membershipmodel,this.portfoliolistmodel)},remove:function(){this.membershipModelBinder.unbind(),this.uploadModelBinder.unbind(),this.$el.empty()}});var fmt=money.fmt();App.margins={top:40,right:40,bottom:60,left:150},App.AppRouter=Backbone.Router.extend({routes:{"@url":"def"},def:function(e){}}),App.main=new App.MainView({el:$("body")}),App.main.render(),$(function(){App.app=new App.AppRouter,Backbone.history.start()});